/*
 * custom_math.c
 *
 * Created: 26.04.2018 19:47:35
 *  Author: Pawel
 */

#include <avr/pgmspace.h>
#include <stdlib.h>
#include <math.h>
#include <util/delay.h>
#include "custom_math.h"
#include "rs232/rs232.h"



extern int16_t samples[1024];

// table with quarter of sinus (0-pi/2)
const int16_t sin_tab[256] PROGMEM = {
	0,    201,    402,    603,    804,   1005,   1206,   1406,
	1607,   1808,   2009,   2209,   2410,   2610,   2811,   3011,
	3211,   3411,   3611,   3811,   4011,   4210,   4409,   4608,
	4807,   5006,   5205,   5403,   5601,   5799,   5997,   6195,
	6392,   6589,   6786,   6982,   7179,   7375,   7571,   7766,
	7961,   8156,   8351,   8545,   8739,   8932,   9126,   9319,
	9511,   9703,   9895,  10087,  10278,  10469,  10659,  10849,
	11038,  11227,  11416,  11604,  11792,  11980,  12166,  12353,
	12539,  12724,  12909,  13094,  13278,  13462,  13645,  13827,
	14009,  14191,  14372,  14552,  14732,  14911,  15090,  15268,
	15446,  15623,  15799,  15975,  16150,  16325,  16499,  16672,
	16845,  17017,  17189,  17360,  17530,  17699,  17868,  18036,
	18204,  18371,  18537,  18702,  18867,  19031,  19194,  19357,
	19519,  19680,  19840,  20000,  20159,  20317,  20474,  20631,
	20787,  20942,  21096,  21249,  21402,  21554,  21705,  21855,
	22004,  22153,  22301,  22448,  22594,  22739,  22883,  23027,
	23169,  23311,  23452,  23592,  23731,  23869,  24006,  24143,
	24278,  24413,  24546,  24679,  24811,  24942,  25072,  25201,
	25329,  25456,  25582,  25707,  25831,  25954,  26077,  26198,
	26318,  26437,  26556,  26673,  26789,  26905,  27019,  27132,
	27244,  27355,  27466,  27575,  27683,  27790,  27896,  28001,
	28105,  28208,  28309,  28410,  28510,  28608,  28706,  28802,
	28897,  28992,  29085,  29177,  29268,  29358,  29446,  29534,
	29621,  29706,  29790,  29873,  29955,  30036,  30116,  30195,
	30272,  30349,  30424,  30498,  30571,  30643,  30713,  30783,
	30851,  30918,  30984,  31049,  31113,  31175,  31236,  31297,
	31356,  31413,  31470,  31525,  31580,  31633,  31684,  31735,
	31785,  31833,  31880,  31926,  31970,  32014,  32056,  32097,
	32137,  32176,  32213,  32249,  32284,  32318,  32350,  32382,
	32412,  32441,  32468,  32495,  32520,  32544,  32567,  32588,
	32609,  32628,  32646,  32662,  32678,  32692,  32705,  32717,
	32727,  32736,  32744,  32751,  32757,  32761,  32764,  32767,
};
		

// time windows tables
const int16_t hanning_table[1024] PROGMEM = {
	0,     0,     1,     2,     4,     7,     11,    15,    19,    25,    30,
	37,    44,    52,    60,    69,    79,    89,    100,   111,   123,   136,
	149,   163,   177,   192,   208,   224,   241,   259,   277,   296,   315,
	335,   355,   377,   398,   421,   444,   467,   491,   516,   542,   568,
	594,   621,   649,   677,   706,   736,   766,   797,   828,   860,   892,
	925,   959,   993,   1028,  1064,  1099,  1136,  1173,  1211,  1249,  1288,
	1327,  1367,  1408,  1449,  1491,  1533,  1576,  1619,  1663,  1707,  1752,
	1798,  1844,  1891,  1938,  1986,  2034,  2083,  2132,  2182,  2232,  2283,
	2335,  2387,  2440,  2493,  2546,  2600,  2655,  2710,  2766,  2822,  2879,
	2936,  2994,  3052,  3111,  3170,  3230,  3290,  3351,  3412,  3474,  3536,
	3599,  3662,  3725,  3790,  3854,  3919,  3985,  4051,  4117,  4184,  4252,
	4320,  4388,  4457,  4526,  4596,  4666,  4736,  4807,  4879,  4950,  5023,
	5095,  5169,  5242,  5316,  5391,  5465,  5541,  5616,  5692,  5769,  5846,
	5923,  6001,  6079,  6157,  6236,  6315,  6395,  6475,  6555,  6636,  6717,
	6798,  6880,  6962,  7045,  7127,  7211,  7294,  7378,  7462,  7547,  7632,
	7717,  7803,  7888,  7975,  8061,  8148,  8235,  8323,  8410,  8498,  8587,
	8675,  8764,  8854,  8943,  9033,  9123,  9213,  9304,  9395,  9486,  9577,
	9669,  9761,  9853,  9945,  10038, 10131, 10224, 10318, 10411, 10505, 10599,
	10693, 10788, 10882, 10977, 11072, 11168, 11263, 11359, 11455, 11551, 11647,
	11743, 11840, 11937, 12034, 12131, 12228, 12326, 12423, 12521, 12619, 12717,
	12815, 12913, 13012, 13110, 13209, 13308, 13406, 13505, 13605, 13704, 13803,
	13903, 14002, 14102, 14201, 14301, 14401, 14501, 14601, 14701, 14801, 14901,
	15001, 15102, 15202, 15303, 15403, 15503, 15604, 15704, 15805, 15906, 16006,
	16107, 16207, 16308, 16409, 16509, 16610, 16711, 16811, 16912, 17012, 17113,
	17213, 17314, 17414, 17515, 17615, 17715, 17816, 17916, 18016, 18116, 18216,
	18316, 18416, 18516, 18616, 18715, 18815, 18914, 19014, 19113, 19212, 19311,
	19410, 19509, 19608, 19706, 19805, 19903, 20001, 20099, 20197, 20295, 20393,
	20490, 20588, 20685, 20782, 20879, 20975, 21072, 21168, 21264, 21360, 21456,
	21552, 21647, 21742, 21837, 21932, 22027, 22121, 22215, 22309, 22403, 22496,
	22589, 22682, 22775, 22868, 22960, 23052, 23144, 23235, 23327, 23418, 23508,
	23599, 23689, 23779, 23869, 23958, 24047, 24136, 24224, 24313, 24401, 24488,
	24575, 24662, 24749, 24836, 24922, 25007, 25093, 25178, 25263, 25347, 25431,
	25515, 25598, 25681, 25764, 25846, 25928, 26010, 26091, 26172, 26252, 26332,
	26412, 26492, 26571, 26649, 26727, 26805, 26883, 26960, 27036, 27113, 27189,
	27264, 27339, 27414, 27488, 27562, 27635, 27708, 27780, 27853, 27924, 27995,
	28066, 28136, 28206, 28276, 28345, 28413, 28481, 28549, 28616, 28683, 28749,
	28815, 28880, 28945, 29010, 29073, 29137, 29200, 29262, 29324, 29386, 29447,
	29507, 29567, 29627, 29686, 29744, 29802, 29860, 29917, 29973, 30029, 30084,
	30139, 30194, 30248, 30301, 30354, 30406, 30458, 30509, 30560, 30610, 30660,
	30709, 30757, 30805, 30853, 30900, 30946, 30992, 31037, 31082, 31126, 31170,
	31213, 31255, 31297, 31339, 31380, 31420, 31459, 31499, 31537, 31575, 31613,
	31649, 31686, 31721, 31756, 31791, 31825, 31858, 31891, 31923, 31955, 31986,
	32016, 32046, 32075, 32104, 32132, 32159, 32186, 32212, 32238, 32263, 32288,
	32312, 32335, 32358, 32380, 32401, 32422, 32442, 32462, 32481, 32499, 32517,
	32534, 32551, 32567, 32582, 32597, 32611, 32625, 32638, 32650, 32662, 32673,
	32683, 32693, 32703, 32711, 32719, 32727, 32733, 32740, 32745, 32750, 32754,
	32758, 32761, 32764, 32766, 32767, 32767, 32767, 32767, 32766, 32764, 32761,
	32758, 32754, 32750, 32745, 32740, 32733, 32727, 32719, 32711, 32703, 32693,
	32683, 32673, 32662, 32650, 32638, 32625, 32611, 32597, 32582, 32567, 32551,
	32534, 32517, 32499, 32481, 32462, 32442, 32422, 32401, 32380, 32358, 32335,
	32312, 32288, 32263, 32238, 32212, 32186, 32159, 32132, 32104, 32075, 32046,
	32016, 31986, 31955, 31923, 31891, 31858, 31825, 31791, 31756, 31721, 31686,
	31649, 31613, 31575, 31537, 31499, 31459, 31420, 31380, 31339, 31297, 31255,
	31213, 31170, 31126, 31082, 31037, 30992, 30946, 30900, 30853, 30805, 30757,
	30709, 30660, 30610, 30560, 30509, 30458, 30406, 30354, 30301, 30248, 30194,
	30139, 30084, 30029, 29973, 29917, 29860, 29802, 29744, 29686, 29627, 29567,
	29507, 29447, 29386, 29324, 29262, 29200, 29137, 29073, 29010, 28945, 28880,
	28815, 28749, 28683, 28616, 28549, 28481, 28413, 28345, 28276, 28206, 28136,
	28066, 27995, 27924, 27853, 27780, 27708, 27635, 27562, 27488, 27414, 27339,
	27264, 27189, 27113, 27036, 26960, 26883, 26805, 26727, 26649, 26571, 26492,
	26412, 26332, 26252, 26172, 26091, 26010, 25928, 25846, 25764, 25681, 25598,
	25515, 25431, 25347, 25263, 25178, 25093, 25007, 24922, 24836, 24749, 24662,
	24576, 24488, 24401, 24313, 24224, 24136, 24047, 23958, 23869, 23779, 23689,
	23599, 23508, 23418, 23327, 23235, 23144, 23052, 22960, 22868, 22775, 22682,
	22589, 22496, 22403, 22309, 22215, 22121, 22027, 21932, 21837, 21742, 21647,
	21552, 21456, 21360, 21264, 21168, 21072, 20975, 20879, 20782, 20685, 20588,
	20490, 20393, 20295, 20197, 20099, 20001, 19903, 19805, 19706, 19608, 19509,
	19410, 19311, 19212, 19113, 19014, 18914, 18815, 18715, 18616, 18516, 18416,
	18316, 18216, 18116, 18016, 17916, 17816, 17715, 17615, 17515, 17414, 17314,
	17213, 17113, 17012, 16912, 16811, 16711, 16610, 16509, 16409, 16308, 16207,
	16107, 16006, 15906, 15805, 15704, 15604, 15503, 15403, 15303, 15202, 15102,
	15001, 14901, 14801, 14701, 14601, 14501, 14401, 14301, 14201, 14102, 14002,
	13903, 13803, 13704, 13605, 13505, 13406, 13308, 13209, 13110, 13012, 12913,
	12815, 12717, 12619, 12521, 12423, 12326, 12228, 12131, 12034, 11937, 11840,
	11743, 11647, 11551, 11455, 11359, 11263, 11168, 11072, 10977, 10882, 10788,
	10693, 10599, 10505, 10411, 10318, 10224, 10131, 10038, 9945,  9853,  9761,
	9669,  9577,  9486,  9395,  9304,  9213,  9123,  9033,  8943,  8854,  8764,
	8675,  8587,  8498,  8410,  8323,  8235,  8148,  8061,  7975,  7888,  7803,
	7717,  7632,  7547,  7462,  7378,  7294,  7211,  7127,  7045,  6962,  6880,
	6798,  6717,  6636,  6555,  6475,  6395,  6315,  6236,  6157,  6079,  6001,
	5923,  5846,  5769,  5692,  5616,  5541,  5465,  5391,  5316,  5242,  5169,
	5095,  5023,  4950,  4879,  4807,  4736,  4666,  4596,  4526,  4457,  4388,
	4320,  4252,  4184,  4117,  4051,  3985,  3919,  3854,  3790,  3725,  3662,
	3599,  3536,  3474,  3412,  3351,  3290,  3230,  3170,  3111,  3052,  2994,
	2936,  2879,  2822,  2766,  2710,  2655,  2600,  2546,  2493,  2440,  2387,
	2335,  2283,  2232,  2182,  2132,  2083,  2034,  1986,  1938,  1891,  1844,
	1798,  1752,  1707,  1663,  1619,  1576,  1533,  1491,  1449,  1408,  1367,
	1327,  1288,  1249,  1211,  1173,  1136,  1099,  1064,  1028,  993,   959,
	925,   892,   860,   828,   797,   766,   736,   706,   677,   649,   621,
	594,   568,   542,   516,   491,   467,   444,   421,   398,   377,   355,
	335,   315,   296,   277,   259,   241,   224,   208,   192,   177,   163,
	149,   136,   123,   111,   100,   89,    79,    69,    60,    52,    44,
	37,    30,    25,    19,    15,    11,    7,     4,     2,     1,     0,
	0};	
	
const int16_t PROGMEM hamming_table[1024] = {
	2513,  2514,  2515,  2516,  2518,  2521,  2524,  2527,  2532,  2537,  2542,
	2548,  2555,  2562,  2569,  2578,  2586,  2596,  2606,  2616,  2627,  2639,
	2651,  2664,  2678,  2691,  2706,  2721,  2737,  2753,  2770,  2787,  2805,
	2823,  2842,  2862,  2882,  2902,  2924,  2945,  2968,  2991,  3014,  3038,
	3062,  3088,  3113,  3139,  3166,  3193,  3221,  3250,  3278,  3308,  3338,
	3368,  3399,  3431,  3463,  3496,  3529,  3563,  3597,  3632,  3667,  3703,
	3739,  3776,  3814,  3852,  3890,  3929,  3969,  4009,  4049,  4090,  4132,
	4174,  4216,  4259,  4303,  4347,  4392,  4437,  4482,  4528,  4575,  4622,
	4670,  4718,  4766,  4815,  4865,  4915,  4965,  5016,  5068,  5120,  5172,
	5225,  5278,  5332,  5386,  5441,  5496,  5552,  5608,  5664,  5721,  5779,
	5836,  5895,  5954,  6013,  6072,  6133,  6193,  6254,  6315,  6377,  6439,
	6502,  6565,  6629,  6693,  6757,  6822,  6887,  6952,  7018,  7085,  7151,
	7218,  7286,  7354,  7422,  7491,  7560,  7629,  7699,  7770,  7840,  7911,
	7982,  8054,  8126,  8199,  8271,  8344,  8418,  8492,  8566,  8640,  8715,
	8790,  8866,  8942,  9018,  9094,  9171,  9248,  9326,  9404,  9482,  9560,
	9639,  9718,  9797,  9877,  9957,  10037, 10117, 10198, 10279, 10360, 10442,
	10524, 10606, 10688, 10771, 10854, 10937, 11020, 11104, 11188, 11272, 11356,
	11441, 11526, 11611, 11696, 11782, 11868, 11954, 12040, 12126, 12213, 12300,
	12387, 12474, 12561, 12649, 12737, 12825, 12913, 13001, 13090, 13179, 13267,
	13356, 13446, 13535, 13624, 13714, 13804, 13894, 13984, 14074, 14165, 14255,
	14346, 14436, 14527, 14618, 14709, 14800, 14892, 14983, 15075, 15166, 15258,
	15350, 15442, 15534, 15626, 15718, 15810, 15902, 15995, 16087, 16179, 16272,
	16365, 16457, 16550, 16642, 16735, 16828, 16921, 17014, 17106, 17199, 17292,
	17385, 17478, 17571, 17664, 17757, 17850, 17942, 18035, 18128, 18221, 18314,
	18407, 18499, 18592, 18685, 18778, 18870, 18963, 19055, 19148, 19240, 19333,
	19425, 19517, 19609, 19701, 19793, 19885, 19977, 20069, 20160, 20252, 20343,
	20435, 20526, 20617, 20708, 20799, 20890, 20981, 21071, 21162, 21252, 21342,
	21432, 21522, 21612, 21701, 21791, 21880, 21969, 22058, 22147, 22235, 22324,
	22412, 22500, 22588, 22676, 22763, 22851, 22938, 23025, 23111, 23198, 23284,
	23370, 23456, 23542, 23627, 23712, 23797, 23882, 23967, 24051, 24135, 24219,
	24302, 24386, 24469, 24551, 24634, 24716, 24798, 24880, 24961, 25043, 25123,
	25204, 25284, 25364, 25444, 25524, 25603, 25682, 25760, 25838, 25916, 25994,
	26071, 26148, 26225, 26301, 26377, 26453, 26528, 26603, 26678, 26752, 26826,
	26900, 26973, 27046, 27119, 27191, 27263, 27334, 27405, 27476, 27547, 27617,
	27686, 27756, 27824, 27893, 27961, 28029, 28096, 28163, 28230, 28296, 28362,
	28427, 28492, 28556, 28620, 28684, 28747, 28810, 28873, 28935, 28996, 29057,
	29118, 29179, 29238, 29298, 29357, 29415, 29473, 29531, 29588, 29645, 29701,
	29757, 29813, 29868, 29922, 29976, 30030, 30083, 30135, 30187, 30239, 30290,
	30341, 30391, 30441, 30490, 30539, 30587, 30635, 30682, 30729, 30776, 30821,
	30867, 30912, 30956, 31000, 31043, 31086, 31128, 31170, 31211, 31252, 31292,
	31332, 31371, 31410, 31448, 31486, 31523, 31560, 31596, 31632, 31667, 31701,
	31735, 31769, 31802, 31834, 31866, 31897, 31928, 31958, 31988, 32017, 32046,
	32074, 32101, 32128, 32155, 32181, 32206, 32231, 32255, 32279, 32302, 32325,
	32347, 32368, 32389, 32409, 32429, 32448, 32467, 32485, 32503, 32520, 32536,
	32552, 32568, 32582, 32597, 32610, 32623, 32636, 32648, 32659, 32670, 32680,
	32690, 32699, 32708, 32716, 32723, 32730, 32736, 32742, 32747, 32751, 32755,
	32759, 32762, 32764, 32766, 32767, 32767, 32767, 32767, 32766, 32764, 32762,
	32759, 32755, 32751, 32747, 32742, 32736, 32730, 32723, 32716, 32708, 32699,
	32690, 32680, 32670, 32659, 32648, 32636, 32623, 32610, 32597, 32582, 32568,
	32552, 32536, 32520, 32503, 32485, 32467, 32448, 32429, 32409, 32389, 32368,
	32347, 32325, 32302, 32279, 32255, 32231, 32206, 32181, 32155, 32128, 32101,
	32074, 32046, 32017, 31988, 31958, 31928, 31897, 31866, 31834, 31802, 31769,
	31735, 31701, 31667, 31632, 31596, 31560, 31523, 31486, 31448, 31410, 31371,
	31332, 31292, 31252, 31211, 31170, 31128, 31086, 31043, 31000, 30956, 30912,
	30867, 30821, 30776, 30729, 30682, 30635, 30587, 30539, 30490, 30441, 30391,
	30341, 30290, 30239, 30187, 30135, 30083, 30030, 29976, 29922, 29868, 29813,
	29757, 29701, 29645, 29588, 29531, 29473, 29415, 29357, 29298, 29238, 29179,
	29118, 29057, 28996, 28935, 28873, 28810, 28747, 28684, 28620, 28556, 28492,
	28427, 28362, 28296, 28230, 28163, 28096, 28029, 27961, 27893, 27824, 27756,
	27686, 27617, 27547, 27476, 27405, 27334, 27263, 27191, 27119, 27046, 26973,
	26900, 26826, 26752, 26678, 26603, 26528, 26453, 26377, 26301, 26225, 26148,
	26071, 25994, 25916, 25838, 25760, 25682, 25603, 25524, 25444, 25364, 25284,
	25204, 25123, 25043, 24961, 24880, 24798, 24716, 24634, 24551, 24469, 24386,
	24302, 24219, 24135, 24051, 23967, 23882, 23797, 23712, 23627, 23542, 23456,
	23370, 23284, 23198, 23111, 23025, 22938, 22851, 22763, 22676, 22588, 22500,
	22412, 22324, 22235, 22147, 22058, 21969, 21880, 21791, 21701, 21612, 21522,
	21432, 21342, 21252, 21162, 21071, 20981, 20890, 20799, 20708, 20617, 20526,
	20435, 20343, 20252, 20160, 20069, 19977, 19885, 19793, 19701, 19609, 19517,
	19425, 19333, 19240, 19148, 19055, 18963, 18870, 18778, 18685, 18592, 18499,
	18407, 18314, 18221, 18128, 18035, 17942, 17850, 17757, 17664, 17571, 17478,
	17385, 17292, 17199, 17106, 17014, 16921, 16828, 16735, 16642, 16550, 16457,
	16365, 16272, 16179, 16087, 15995, 15902, 15810, 15718, 15626, 15534, 15442,
	15350, 15258, 15166, 15075, 14983, 14892, 14800, 14709, 14618, 14527, 14436,
	14346, 14255, 14165, 14074, 13984, 13894, 13804, 13714, 13624, 13535, 13446,
	13356, 13267, 13179, 13090, 13001, 12913, 12825, 12737, 12649, 12561, 12474,
	12387, 12300, 12213, 12126, 12040, 11954, 11868, 11782, 11696, 11611, 11526,
	11441, 11356, 11272, 11188, 11104, 11020, 10937, 10854, 10771, 10688, 10606,
	10524, 10442, 10360, 10279, 10198, 10117, 10037, 9957,  9877,  9797,  9718,
	9639,  9560,  9482,  9404,  9326,  9248,  9171,  9094,  9018,  8942,  8866,
	8790,  8715,  8640,  8566,  8492,  8418,  8344,  8271,  8199,  8126,  8054,
	7982,  7911,  7840,  7770,  7699,  7629,  7560,  7491,  7422,  7354,  7286,
	7218,  7151,  7085,  7018,  6952,  6887,  6822,  6757,  6693,  6629,  6565,
	6502,  6439,  6377,  6315,  6254,  6193,  6133,  6072,  6013,  5954,  5895,
	5836,  5779,  5721,  5664,  5608,  5552,  5496,  5441,  5386,  5332,  5278,
	5225,  5172,  5120,  5068,  5016,  4965,  4915,  4865,  4815,  4766,  4718,
	4670,  4622,  4575,  4528,  4482,  4437,  4392,  4347,  4303,  4259,  4216,
	4174,  4132,  4090,  4049,  4009,  3969,  3929,  3890,  3852,  3814,  3776,
	3739,  3703,  3667,  3632,  3597,  3563,  3529,  3496,  3463,  3431,  3399,
	3368,  3338,  3308,  3278,  3250,  3221,  3193,  3166,  3139,  3113,  3088,
	3062,  3038,  3014,  2991,  2968,  2945,  2924,  2902,  2882,  2862,  2842,
	2823,  2805,  2787,  2770,  2753,  2737,  2721,  2706,  2691,  2678,  2664,
	2651,  2639,  2627,  2616,  2606,  2596,  2586,  2578,  2569,  2562,  2555,
	2548,  2542,  2537,  2532,  2527,  2524,  2521,  2518,  2516,  2515,  2514,
	2513};	

const int16_t triangle_table[1024] PROGMEM = {
	64,    128,   192,   256,   320,   384,   448,   512,   576,   640,   704,
	768,   832,   896,   960,   1024,  1088,  1152,  1216,  1280,  1344,  1408,
	1472,  1536,  1600,  1664,  1728,  1792,  1856,  1920,  1984,  2048,  2112,
	2176,  2240,  2304,  2368,  2432,  2496,  2560,  2624,  2688,  2752,  2816,
	2880,  2944,  3008,  3072,  3136,  3200,  3264,  3328,  3392,  3456,  3520,
	3584,  3648,  3712,  3776,  3840,  3904,  3968,  4032,  4096,  4160,  4224,
	4288,  4352,  4416,  4480,  4544,  4608,  4672,  4736,  4800,  4864,  4928,
	4992,  5056,  5120,  5184,  5248,  5312,  5376,  5440,  5504,  5568,  5632,
	5696,  5760,  5824,  5888,  5952,  6016,  6080,  6144,  6208,  6272,  6336,
	6400,  6464,  6528,  6592,  6656,  6720,  6784,  6848,  6912,  6976,  7040,
	7104,  7168,  7232,  7296,  7360,  7424,  7488,  7552,  7616,  7680,  7744,
	7808,  7872,  7936,  8000,  8064,  8128,  8192,  8256,  8320,  8384,  8448,
	8512,  8576,  8640,  8704,  8768,  8832,  8896,  8960,  9024,  9088,  9152,
	9216,  9280,  9344,  9408,  9472,  9536,  9600,  9664,  9728,  9792,  9856,
	9920,  9984,  10048, 10112, 10176, 10240, 10304, 10368, 10432, 10496, 10560,
	10624, 10688, 10752, 10816, 10880, 10944, 11008, 11072, 11136, 11200, 11264,
	11328, 11392, 11456, 11520, 11584, 11648, 11712, 11776, 11840, 11904, 11968,
	12032, 12096, 12160, 12224, 12288, 12352, 12416, 12480, 12544, 12608, 12672,
	12736, 12800, 12864, 12928, 12992, 13056, 13120, 13184, 13248, 13312, 13376,
	13440, 13504, 13568, 13632, 13696, 13760, 13824, 13888, 13952, 14016, 14080,
	14144, 14208, 14272, 14336, 14400, 14464, 14528, 14592, 14656, 14720, 14784,
	14848, 14912, 14976, 15040, 15104, 15168, 15232, 15296, 15360, 15424, 15488,
	15552, 15616, 15680, 15744, 15808, 15872, 15936, 16000, 16064, 16128, 16192,
	16256, 16320, 16384, 16448, 16512, 16576, 16640, 16704, 16768, 16832, 16896,
	16960, 17024, 17088, 17152, 17216, 17280, 17344, 17408, 17472, 17536, 17600,
	17664, 17728, 17792, 17856, 17920, 17984, 18048, 18112, 18176, 18240, 18304,
	18368, 18432, 18496, 18560, 18624, 18688, 18752, 18816, 18880, 18944, 19008,
	19072, 19136, 19200, 19264, 19328, 19392, 19456, 19520, 19584, 19648, 19712,
	19776, 19840, 19904, 19968, 20032, 20096, 20160, 20224, 20288, 20352, 20416,
	20480, 20544, 20608, 20672, 20736, 20800, 20864, 20928, 20992, 21056, 21120,
	21184, 21248, 21312, 21376, 21440, 21504, 21568, 21632, 21696, 21760, 21824,
	21888, 21952, 22016, 22080, 22144, 22208, 22272, 22336, 22400, 22464, 22528,
	22592, 22656, 22720, 22784, 22848, 22912, 22976, 23040, 23104, 23168, 23232,
	23296, 23360, 23424, 23488, 23552, 23616, 23680, 23744, 23808, 23872, 23936,
	24000, 24064, 24128, 24192, 24256, 24320, 24384, 24448, 24512, 24576, 24640,
	24704, 24768, 24832, 24896, 24960, 25024, 25088, 25152, 25216, 25280, 25344,
	25408, 25472, 25536, 25600, 25664, 25728, 25792, 25856, 25920, 25984, 26048,
	26112, 26176, 26240, 26304, 26368, 26432, 26496, 26560, 26624, 26688, 26752,
	26816, 26880, 26944, 27008, 27072, 27136, 27200, 27264, 27328, 27392, 27456,
	27520, 27584, 27648, 27712, 27776, 27840, 27904, 27968, 28032, 28096, 28160,
	28224, 28288, 28352, 28416, 28480, 28544, 28608, 28672, 28736, 28800, 28864,
	28928, 28992, 29056, 29120, 29184, 29248, 29312, 29376, 29440, 29504, 29568,
	29632, 29696, 29760, 29824, 29888, 29952, 30016, 30080, 30144, 30208, 30272,
	30336, 30400, 30464, 30528, 30592, 30656, 30720, 30784, 30848, 30912, 30976,
	31040, 31104, 31168, 31232, 31296, 31360, 31424, 31488, 31552, 31616, 31680,
	31744, 31808, 31872, 31936, 32000, 32064, 32128, 32192, 32256, 32320, 32384,
	32448, 32512, 32576, 32640, 32704, 32768, 32704, 32640, 32576, 32512, 32448,
	32384, 32320, 32256, 32192, 32128, 32064, 32000, 31936, 31872, 31808, 31744,
	31680, 31616, 31552, 31488, 31424, 31360, 31296, 31232, 31168, 31104, 31040,
	30976, 30912, 30848, 30784, 30720, 30656, 30592, 30528, 30464, 30400, 30336,
	30272, 30208, 30144, 30080, 30016, 29952, 29888, 29824, 29760, 29696, 29632,
	29568, 29504, 29440, 29376, 29312, 29248, 29184, 29120, 29056, 28992, 28928,
	28864, 28800, 28736, 28672, 28608, 28544, 28480, 28416, 28352, 28288, 28224,
	28160, 28096, 28032, 27968, 27904, 27840, 27776, 27712, 27648, 27584, 27520,
	27456, 27392, 27328, 27264, 27200, 27136, 27072, 27008, 26944, 26880, 26816,
	26752, 26688, 26624, 26560, 26496, 26432, 26368, 26304, 26240, 26176, 26112,
	26048, 25984, 25920, 25856, 25792, 25728, 25664, 25600, 25536, 25472, 25408,
	25344, 25280, 25216, 25152, 25088, 25024, 24960, 24896, 24832, 24768, 24704,
	24640, 24576, 24512, 24448, 24384, 24320, 24256, 24192, 24128, 24064, 24000,
	23936, 23872, 23808, 23744, 23680, 23616, 23552, 23488, 23424, 23360, 23296,
	23232, 23168, 23104, 23040, 22976, 22912, 22848, 22784, 22720, 22656, 22592,
	22528, 22464, 22400, 22336, 22272, 22208, 22144, 22080, 22016, 21952, 21888,
	21824, 21760, 21696, 21632, 21568, 21504, 21440, 21376, 21312, 21248, 21184,
	21120, 21056, 20992, 20928, 20864, 20800, 20736, 20672, 20608, 20544, 20480,
	20416, 20352, 20288, 20224, 20160, 20096, 20032, 19968, 19904, 19840, 19776,
	19712, 19648, 19584, 19520, 19456, 19392, 19328, 19264, 19200, 19136, 19072,
	19008, 18944, 18880, 18816, 18752, 18688, 18624, 18560, 18496, 18432, 18368,
	18304, 18240, 18176, 18112, 18048, 17984, 17920, 17856, 17792, 17728, 17664,
	17600, 17536, 17472, 17408, 17344, 17280, 17216, 17152, 17088, 17024, 16960,
	16896, 16832, 16768, 16704, 16640, 16576, 16512, 16448, 16384, 16320, 16256,
	16192, 16128, 16064, 16000, 15936, 15872, 15808, 15744, 15680, 15616, 15552,
	15488, 15424, 15360, 15296, 15232, 15168, 15104, 15040, 14976, 14912, 14848,
	14784, 14720, 14656, 14592, 14528, 14464, 14400, 14336, 14272, 14208, 14144,
	14080, 14016, 13952, 13888, 13824, 13760, 13696, 13632, 13568, 13504, 13440,
	13376, 13312, 13248, 13184, 13120, 13056, 12992, 12928, 12864, 12800, 12736,
	12672, 12608, 12544, 12480, 12416, 12352, 12288, 12224, 12160, 12096, 12032,
	11968, 11904, 11840, 11776, 11712, 11648, 11584, 11520, 11456, 11392, 11328,
	11264, 11200, 11136, 11072, 11008, 10944, 10880, 10816, 10752, 10688, 10624,
	10560, 10496, 10432, 10368, 10304, 10240, 10176, 10112, 10048, 9984,  9920,
	9856,  9792,  9728,  9664,  9600,  9536,  9472,  9408,  9344,  9280,  9216,
	9152,  9088,  9024,  8960,  8896,  8832,  8768,  8704,  8640,  8576,  8512,
	8448,  8384,  8320,  8256,  8192,  8128,  8064,  8000,  7936,  7872,  7808,
	7744,  7680,  7616,  7552,  7488,  7424,  7360,  7296,  7232,  7168,  7104,
	7040,  6976,  6912,  6848,  6784,  6720,  6656,  6592,  6528,  6464,  6400,
	6336,  6272,  6208,  6144,  6080,  6016,  5952,  5888,  5824,  5760,  5696,
	5632,  5568,  5504,  5440,  5376,  5312,  5248,  5184,  5120,  5056,  4992,
	4928,  4864,  4800,  4736,  4672,  4608,  4544,  4480,  4416,  4352,  4288,
	4224,  4160,  4096,  4032,  3968,  3904,  3840,  3776,  3712,  3648,  3584,
	3520,  3456,  3392,  3328,  3264,  3200,  3136,  3072,  3008,  2944,  2880,
	2816,  2752,  2688,  2624,  2560,  2496,  2432,  2368,  2304,  2240,  2176,
	2112,  2048,  1984,  1920,  1856,  1792,  1728,  1664,  1600,  1536,  1472,
	1408,  1344,  1280,  1216,  1152,  1088,  1024,  960,   896,   832,   768,
	704,   640,   576,   512,   448,   384,   320,   256,   192,   128,   64,
	0,
};

const int16_t flat_top_table[1024] PROGMEM = {
	0,     0,     0,     0,     0,     0,     -1,    -1,    -1,    -2,    -2,
	-3,    -4,    -4,    -5,    -6,    -7,    -8,    -9,    -10,   -11,   -13,
	-14,   -15,   -17,   -19,   -20,   -22,   -24,   -26,   -28,   -30,   -32,
	-34,   -36,   -39,   -41,   -44,   -46,   -49,   -52,   -55,   -58,   -62,
	-65,   -68,   -72,   -76,   -79,   -83,   -87,   -92,   -96,   -100,  -105,
	-110,  -115,  -120,  -125,  -130,  -135,  -141,  -147,  -153,  -159,  -165,
	-171,  -178,  -185,  -192,  -199,  -206,  -214,  -221,  -229,  -237,  -245,
	-254,  -262,  -271,  -280,  -289,  -299,  -308,  -318,  -328,  -338,  -349,
	-359,  -370,  -381,  -393,  -404,  -416,  -428,  -440,  -453,  -465,  -478,
	-491,  -505,  -518,  -532,  -546,  -560,  -575,  -590,  -605,  -620,  -635,
	-651,  -667,  -683,  -699,  -716,  -733,  -750,  -767,  -785,  -802,  -820,
	-838,  -857,  -875,  -894,  -913,  -932,  -952,  -972,  -991,  -1011, -1032,
	-1052, -1073, -1094, -1115, -1136, -1157, -1179, -1200, -1222, -1244, -1266,
	-1289, -1311, -1334, -1356, -1379, -1402, -1425, -1448, -1472, -1495, -1518,
	-1542, -1565, -1589, -1613, -1636, -1660, -1684, -1708, -1732, -1755, -1779,
	-1803, -1827, -1850, -1874, -1898, -1921, -1945, -1968, -1991, -2014, -2037,
	-2060, -2083, -2105, -2128, -2150, -2172, -2194, -2215, -2237, -2258, -2279,
	-2299, -2320, -2339, -2359, -2378, -2397, -2416, -2434, -2452, -2469, -2486,
	-2503, -2519, -2535, -2550, -2565, -2579, -2592, -2605, -2618, -2630, -2641,
	-2652, -2662, -2671, -2680, -2688, -2696, -2702, -2708, -2713, -2718, -2721,
	-2724, -2726, -2727, -2728, -2727, -2725, -2723, -2720, -2715, -2710, -2704,
	-2697, -2688, -2679, -2669, -2657, -2645, -2631, -2616, -2600, -2583, -2565,
	-2545, -2525, -2503, -2479, -2455, -2429, -2402, -2374, -2344, -2313, -2280,
	-2246, -2211, -2174, -2136, -2096, -2055, -2013, -1969, -1923, -1876, -1827,
	-1777, -1725, -1671, -1616, -1560, -1501, -1441, -1380, -1316, -1251, -1184,
	-1116, -1046, -974,  -900,  -824,  -747,  -668,  -587,  -505,  -420,  -334,
	-246,  -156,  -64,   29,    124,   222,   321,   422,   525,   630,   737,
	846,   957,   1069,  1184,  1301,  1419,  1539,  1662,  1786,  1912,  2040,
	2170,  2302,  2436,  2572,  2710,  2849,  2991,  3135,  3280,  3427,  3577,
	3728,  3881,  4036,  4193,  4352,  4512,  4675,  4839,  5005,  5173,  5343,
	5515,  5688,  5864,  6041,  6220,  6400,  6583,  6767,  6952,  7140,  7329,
	7520,  7712,  7906,  8102,  8299,  8498,  8699,  8901,  9104,  9309,  9515,
	9723,  9933,  10143, 10355, 10569, 10784, 11000, 11217, 11436, 11656, 11877,
	12099, 12322, 12547, 12772, 12999, 13227, 13455, 13685, 13916, 14147, 14380,
	14613, 14847, 15082, 15317, 15554, 15791, 16028, 16266, 16505, 16745, 16984,
	17225, 17465, 17706, 17948, 18190, 18432, 18674, 18917, 19159, 19402, 19645,
	19888, 20131, 20374, 20617, 20859, 21102, 21344, 21587, 21828, 22070, 22311,
	22552, 22792, 23032, 23272, 23511, 23749, 23986, 24223, 24459, 24695, 24929,
	25163, 25396, 25628, 25859, 26089, 26317, 26545, 26772, 26997, 27221, 27444,
	27665, 27885, 28104, 28322, 28537, 28752, 28964, 29176, 29385, 29593, 29799,
	30003, 30206, 30406, 30605, 30802, 30997, 31190, 31381, 31570, 31756, 31941,
	32123, 32304, 32482, 32657, 32830, 33001, 33170, 33336, 33500, 33661, 33820,
	33976, 34129, 34280, 34428, 34574, 34717, 34857, 34994, 35129, 35261, 35390,
	35516, 35639, 35759, 35876, 35991, 36102, 36210, 36315, 36418, 36517, 36613,
	36706, 36795, 36882, 36965, 37045, 37122, 37196, 37267, 37334, 37398, 37458,
	37516, 37570, 37621, 37668, 37712, 37753, 37790, 37824, 37855, 37882, 37906,
	37926, 37943, 37957, 37967, 37974, 37977, 37977, 37974, 37967, 37957, 37943,
	37926, 37906, 37882, 37855, 37824, 37790, 37753, 37712, 37668, 37621, 37570,
	37516, 37458, 37398, 37334, 37267, 37196, 37122, 37045, 36965, 36882, 36795,
	36706, 36613, 36517, 36418, 36315, 36210, 36102, 35991, 35876, 35759, 35639,
	35516, 35390, 35261, 35129, 34994, 34857, 34717, 34574, 34428, 34280, 34129,
	33976, 33820, 33661, 33500, 33336, 33170, 33001, 32830, 32657, 32482, 32304,
	32123, 31941, 31756, 31570, 31381, 31190, 30997, 30802, 30605, 30406, 30206,
	30003, 29799, 29593, 29385, 29176, 28964, 28752, 28537, 28322, 28104, 27885,
	27665, 27444, 27221, 26997, 26772, 26545, 26317, 26089, 25859, 25628, 25396,
	25163, 24929, 24695, 24459, 24223, 23986, 23749, 23511, 23272, 23032, 22792,
	22552, 22311, 22070, 21828, 21587, 21344, 21102, 20859, 20617, 20374, 20131,
	19888, 19645, 19402, 19159, 18917, 18674, 18432, 18190, 17948, 17706, 17465,
	17225, 16984, 16745, 16505, 16266, 16028, 15791, 15554, 15317, 15082, 14847,
	14613, 14380, 14147, 13916, 13685, 13455, 13227, 12999, 12772, 12547, 12322,
	12099, 11877, 11656, 11436, 11217, 11000, 10784, 10569, 10355, 10143, 9933,
	9723,  9515,  9309,  9104,  8901,  8699,  8498,  8299,  8102,  7906,  7712,
	7520,  7329,  7140,  6952,  6767,  6583,  6400,  6220,  6041,  5864,  5688,
	5515,  5343,  5173,  5005,  4839,  4675,  4512,  4352,  4193,  4036,  3881,
	3728,  3577,  3427,  3280,  3135,  2991,  2849,  2710,  2572,  2436,  2302,
	2170,  2040,  1912,  1786,  1662,  1539,  1419,  1301,  1184,  1069,  957,
	846,   737,   630,   525,   422,   321,   222,   124,   29,    -64,   -156,
	-246,  -334,  -420,  -505,  -587,  -668,  -747,  -824,  -900,  -974,  -1046,
	-1116, -1184, -1251, -1316, -1380, -1441, -1501, -1560, -1616, -1671, -1725,
	-1777, -1827, -1876, -1923, -1969, -2013, -2055, -2096, -2136, -2174, -2211,
	-2246, -2280, -2313, -2344, -2374, -2402, -2429, -2455, -2479, -2503, -2525,
	-2545, -2565, -2583, -2600, -2616, -2631, -2645, -2657, -2669, -2679, -2688,
	-2697, -2704, -2710, -2715, -2720, -2723, -2725, -2727, -2728, -2727, -2726,
	-2724, -2721, -2718, -2713, -2708, -2702, -2696, -2688, -2680, -2671, -2662,
	-2652, -2641, -2630, -2618, -2605, -2592, -2579, -2565, -2550, -2535, -2519,
	-2503, -2486, -2469, -2452, -2434, -2416, -2397, -2378, -2359, -2339, -2320,
	-2299, -2279, -2258, -2237, -2215, -2194, -2172, -2150, -2128, -2105, -2083,
	-2060, -2037, -2014, -1991, -1968, -1945, -1921, -1898, -1874, -1850, -1827,
	-1803, -1779, -1755, -1732, -1708, -1684, -1660, -1636, -1613, -1589, -1565,
	-1542, -1518, -1495, -1472, -1448, -1425, -1402, -1379, -1356, -1334, -1311,
	-1289, -1266, -1244, -1222, -1200, -1179, -1157, -1136, -1115, -1094, -1073,
	-1052, -1032, -1011, -991,  -972,  -952,  -932,  -913,  -894,  -875,  -857,
	-838,  -820,  -802,  -785,  -767,  -750,  -733,  -716,  -699,  -683,  -667,
	-651,  -635,  -620,  -605,  -590,  -575,  -560,  -546,  -532,  -518,  -505,
	-491,  -478,  -465,  -453,  -440,  -428,  -416,  -404,  -393,  -381,  -370,
	-359,  -349,  -338,  -328,  -318,  -308,  -299,  -289,  -280,  -271,  -262,
	-254,  -245,  -237,  -229,  -221,  -214,  -206,  -199,  -192,  -185,  -178,
	-171,  -165,  -159,  -153,  -147,  -141,  -135,  -130,  -125,  -120,  -115,
	-110,  -105,  -100,  -96,   -92,   -87,   -83,   -79,   -76,   -72,   -68,
	-65,   -62,   -58,   -55,   -52,   -49,   -46,   -44,   -41,   -39,   -36,
	-34,   -32,   -30,   -28,   -26,   -24,   -22,   -20,   -19,   -17,   -15,
	-14,   -13,   -11,   -10,   -9,    -8,    -7,    -6,    -5,    -4,    -4,
	-3,    -2,    -2,    -1,    -1,    -1,    0,     0,     0,     0,     0,
0};


// special low flash, ram and cpu cycles requirement functions
// input: k - angle in format: (k/1024)*2*PI
// output: value of sin/cos function multiplied by 32767
int16_t sinus(int k) {
  // find half of sin (sin(x+pi)=-sin(x))
  int8_t s = 1;
  while (k > 511) {
    s = -s;
    k -= 512;
  }
  // find quater and return val (sin(k)=sin(pi-k),kE<0,pi/2>)
  if (k < 256) {
    return s * (int16_t)pgm_read_word(&sin_tab[k]);
  } else {
    return s * (int16_t)pgm_read_word(&sin_tab[511 - k]);
  }
}

int16_t cosinus(int k) {
  // cos(x)=sin(x+pi/2)
  return sinus(k + 256);
}

// function to scaling probes when fft is computing
// input: a - Wx core from fft algorithm butterfly
// b - current value of sample
// output: scaled sample value
static int16_t fix_mpy(int16_t a, int16_t b) {
  // shift right one less bit (i.e. 15-1)
  int32_t c = ((int32_t)a * (int32_t)b) >> 14;
  // last bit shifted out = rounding-bit
  b = c & 0x01;
  // last shift + rounding bit
  a = (c >> 1) + b;
  return a;
}

// function to calc complex fast fourier transform
// input: fr[n],fi[n] are re and im array of probes
// m - log2(number of probes)
// output: the result lands in this same arrays
void fix_fft(int16_t fr[], int16_t fi[], int16_t m) {
  int32_t mr, nn, i, j, l, k, istep, n, shift;
  int16_t qr, qi, tr, ti, wr, wi;
  n = 1 << m;
  mr = 0;
  nn = n - 1;
  // DIT - decimation in time
  // first replace probes positions
  for (m = 1; m <= nn; ++m) {
    l = n;
    do {
      l >>= 1;
    } while (mr + l > nn);
    mr = (mr & (l - 1)) + l;

    if (mr <= m)
      continue;
    tr = fr[m];
    fr[m] = fr[mr];
    fr[mr] = tr;
    ti = fi[m];
    fi[m] = fi[mr];
    fi[mr] = ti;
  }

  l = 1;
  k = 10 - 1;
  // fft alghoritm
  while (l < n) {
    shift = 1;
    istep = l << 1;
    for (m = 0; m < l; ++m) { // first stage
      j = m << k;
      wr = cosinus(j); // calc initial core values
      wi = -sinus(j);
      if (shift) {
        wr >>= 1;
        wi >>= 1;
      }
      for (i = m; i < n; i += istep) { // second stage
        j = i + l;
        // calc single butterfly
        tr = fix_mpy(wr, fr[j]) - fix_mpy(wi, fi[j]);
        ti = fix_mpy(wr, fi[j]) + fix_mpy(wi, fr[j]);
        qr = fr[i];
        qi = fi[i];
        if (shift) {
          qr >>= 1;
          qi >>= 1;
        }
        fr[j] = qr - tr;
        fi[j] = qi - ti;
        fr[i] = qr + tr;
        fi[i] = qi + ti;
      }
    }
    --k;
    l = istep;
  }
}

// function to calc real fast fourier transform
// input: f[] - array of real input probes
// m - log2(number of probes)
// output: the result lands in the same array

void fix_fftr(int16_t f[], int m) {
  int32_t i, N = 1 << (m - 1);
  // sort probes by even/odd
  int16_t tt, *fr = f, *fi = &f[N];
  for (i = 1; i < N; i += 2) {
    tt = f[N + i - 1];
    f[N + i - 1] = f[i];
    f[i] = tt;
  }
  // submit with N/2 points
  fix_fft(fi, fr, m - 1);
}

// calc square root of 32bit integer, based on
// AN FPGA IMPLEMENTATION OF FIXED-POINT SQUARE ROOT OPERATION
// K.PIROMSOPA, C.APORNTEWAN, P.CHONGSATITVANTA
// input: n - the number of which is calculated root
// output: result
uint16_t square_root(uint32_t x) {
  uint32_t op, res, one;

  op = x;
  res = 0;

  // "one" starts at the highest power of four <= than the argument.
  one = ((uint32_t)1 << 30); // second-to-top bit set
  while (one > op)
    one >>= 2;

  while (one != 0) {
    if (op >= res + one) {
      op -= res + one;
      res += one << 1; // <-- faster than 2 * one
    }
    res >>= 1;
    one >>= 2;
  }
  return res;
}

// function to calc magnitude of complex samples
// input: f[] - array of sample where first k/2 probes
// are re part of sample, and second half are im part
// k-number of samples
// function is working only with fix_fftr function
// thats not normal magnitude algorithm
void fix_fft_mag(int16_t f[], int16_t k) {
  // offset
  int32_t tmp;
  tmp = pow(f[0], 2);
  tmp += pow(f[k / 2], 2);
  tmp /= 2;
  tmp = sqyare_root(tmp);
  f[0] = tmp;
  // harmonics
  for (int16_t i = 1; i < k / 2; i++) {
    tmp = pow(f[i] * 2, 2);
    tmp += pow(f[i + (k / 2)] * 2, 2);
    tmp /= 2;
    f[i] = square_root(tmp);
  }
}

// window multiplication function
// input: val - value of probe, w - windows type
// idx - index of probe
// output - the result of multiplication

int16_t window(int16_t val, int8_t w, int16_t idx) {
  int32_t temp = val;
  if (w == 0)
    ;           // RECTANGLE
  if (w == 1) { // HANNING
    temp *= (int16_t)pgm_read_word(&hanning_table[idx]);
    temp >>= 15;
  }
  if (w == 2) { // HAMMING
    temp *= (int16_t)pgm_read_word(&hamming_table[idx]);
    temp >>= 15;
  }
  if (w == 3) { // TRIANGLE
    temp *= (int16_t)pgm_read_word(&triangle_table[idx]);
    temp >>= 15;
  }
  if (w == 4) { // FLAT TOP
    temp *= (int16_t)pgm_read_word(&flat_top_table[idx]);
    temp /= (1 << 13);
  }
  return (int16_t)temp;
}

// Test functions
void fill_test_sinus(int h) {
  for (int i = 0; i < 1024; i++) {
    samples[i] = sinus(2 * h * i) / 128;
  }
}

void fill_test_saw(void) {
  for (int i = 0; i < 256; i++) {
    samples[i] = i * 2;
  }
  for (int i = 0; i < 256; i++) {
    samples[i + 256] = i * 4;
  }
  for (int i = 0; i < 256; i++) {
    samples[i + 512] = i * 4;
  }
  for (int i = 0; i < 256; i++) {
    samples[i + 768] = i * 4;
  }
}

void fill_test_square(void) {
  for (int i = 0; i < 256; i++) {
    samples[i] = 768;
  }
  for (int i = 256; i < 512; i++) {
    samples[i] = 0;
  }
  for (int i = 512; i < 768; i++) {
    samples[i] = 768;
  }
  for (int i = 768; i < 1024; i++) {
    samples[i] = 0;
  }
}

void fill_random_signal(void) {
  for (uint16_t a = 0; a < 1024; a++) {
    samples[a] = 0;
    for (uint8_t b = 0; b < 10; b++) {
      samples[a] |= ((ADCW & 1) << b);
      _delay_us(5);
    }
  }
}
